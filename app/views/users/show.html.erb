<% content_for :javascript_includes do %>
<%= javascript_include_tag "resource_index.js" %>
<% end %>

<% my_corpora = current_user.owner_of %>
<% my_pubs = current_user.publication_owner_of %>
<% my_tools = current_user.tool_owner_of %>

<div class='row-fluid'>
	<div class="span3">
		<div class='box' style='word-wrap: break-word'>
				<div class='boxheader small toggleable'>
					<%= current_user().name%>
				</div>

				<div class='boxcontent padfree'>

					<div class='avatar-wrapper'>
						<div class='profile-avatar-wrapper'>
							<%= image_tag current_user.gravatar_url(:png), :id => :profile_avatar%>
						</div>
						<div id='gravatar-email-wrapper'>
							<input type='email' placeholder='Gravatar Email' id='gravatar-email' value="<%= current_user.gravatar_email || current_user.email %>"/>
						</div>	
					</div>

					<div id='inst_holder'>
						<% inst_flag = false # more efficient this way - SFR %>
						<% current_user.insts.each do |inst| %>
							<span class='badge badge-info inst' id='inst-<%= inst.id %>'><%= inst.name %>
								<span class='x'>&nbsp;
									<i class='icon-remove-sign'></i>
								</span>
							</span>
							<% inst_flag = true %>
						<% end %>
						<span id='add-inst' class='badge badge-info' title="Add Institution">
							<%=raw 'Add Institution &nbsp;' unless inst_flag %>
							<i class='icon-plus-sign'></i>
						</span>
					</div>

					<div id='inst_search_wrapper' style='display:none'>
						<br/>
						<input id='inst_search' type='text' class='span12' placeholder='Add Institution' data-autocomplete="/institutions/autocomplete_institution_name"/>
					</div>

					<span class='email-dec-wrapper'>
						<% current_user.email.split(/(\W)/).each do |part| %>
							<span class='email-dec'><%= part %></span>
						<% end %>
					</span>
			</div>

		</div>

		<div class='alert alert-info' id='gravatar-infobox'>
			<h4>Alternate email address for your <a href='http://en.gravatar.com/' target='_blank'>Gravatar</a> avatar.</h4>
			<p>
				This is only for your avatar. 
				In order to change the email address associated
				with your account
				please visit Settings > Edit Account
			</p>
		</div>

		<input id='people-search' type='text' class='span12' placeholder='Search People'>
		
		<div id='people-result' style="margin-bottom:5px">
		</div>

		<ul class="nav nav-tabs nav-stacked" id='side_menu'>
			<li class='l-nav'><a href='/user/inbox?v=unread' class=''>Inbox <span class='badge pull-right' id='inbox-count'><%= current_user.received_messages.unreaded.size %></span></a></li>
			<li class='l-nav'><a href='/users' class=''>Show All Users</a></li>
			<li class='l-nav'><a href='/user/invite' class=''>Invite a Friend</a></li>
			<li class='l-nav'><a href='/how-to' class=''>How-To <i class='icon-question-sign'></i></a></li>
			<!-- <li class='l-nav'><a href='/graphics/one' class=''>Graph View</a></li> -->

			<!--
			<li class='l-nav'><a href='/corpora' class=''>View All Corpora</a></li>
			<li class='l-nav'><a href='/publications' class=''>View All Publications</a></li>
			<li class='l-nav'><a href='/tools' class=''>View All Tools</a></li>
			-->

			<% unless my_corpora.size > 0 %> <li><a href='/corpora/new' class='lnav_hl'>New Corpus</a></li> <% end %>
			<% unless my_pubs.size > 0 %> <li><a href='/publications/new' class='lnav_hl'>New Publication</a></li> <% end %>
			<% unless my_tools.size > 0 %> <li><a href='/tools/new' class='lnav_hl'>New Tool</a></li> <% end %>
		</ul>
	</div>

	<div class='span5'>
		<div class='row-fluid'>
			<strong>Event Feed</strong>
		</div>
	</div>
	
	<div class='span4'>
		<% if my_corpora.size > 0 %>
			<div class='box borderfree'>
				<div class='boxheader small toggleable'>
					My <%= "Corpus".pluralize(my_corpora.size) %>
					<span class='pull-right resource-count'><%= my_corpora.size%></span>
				</div>
				<div class='boxcontent padfree'>
					<% my_corpora[0...5].each do |corpus| %>
						<%= render :partial => 'shared/corpus_index_small', :locals => {:corpus => corpus} %>
					<% end %>
					<div>
						<!-- corpora -->
						<div class='btn-group pull-right btn-group-hanging'>
							<a href='/corpora/new' class='btn btn-mini'>
								<i class='icon-plus'></i>&nbsp;New
							</a>
							<% if my_corpora.size > 5 %>
								<a href="corpora?query=&roles=owner&order=created_at" class='btn btn-mini'>
									<i class='icon-list'></i>&nbsp;List All
								</a>
							<% end %>
						</div>
					</div>
					<br/>
				</div> <!-- end of box content -->
			</div> <!-- end of box -->
		<% end %>
		

		<% if my_pubs.size > 0 %>
			<div class='box borderfree'>

				<div class='boxheader small toggleable'>
					My <%= "Publication".pluralize(my_pubs.size) %>
					<span class='pull-right resource-count'><%= my_pubs.size %></span>
				</div>

				<div class='boxcontent padfree'>

					<% my_pubs[0...5].each do |pub| %>
						<%= render :partial => 'shared/publication_index_small.html.erb', 
						:locals => {:p => pub} %>
					<% end %>
					<div>
						<!-- publications -->
						<div class='btn-group pull-right btn-group-hanging'>
							<a href='/publications/new' class='btn btn-mini'>
								<i class='icon-plus'></i>&nbsp;New
							</a>
							<% if my_pubs.size > 5 %>
								<a href='publications?query=&roles=owner&order=created_at' class='btn btn-mini'>
									<i class='icon-list'></i>&nbsp;List All
								</a>
							<% end %>
						</div>
					</div>
					</br/>

				</div> <!-- end of boxcontent -->
			</div> <!-- end of box -->
		<% end %>


		<% if my_tools.size > 0 %>
			<div class='box borderfree'>

				<div class='boxheader small toggleable'>
					My <%= "Tool".pluralize(my_tools.size) %>
					<span class='pull-right resource-count'><%= my_tools.size %></span>
				</div>

				<div class='boxcontent padfree'>

					<% my_tools[0...5].each do |tool| %>
						<%= render :partial => 'shared/tool_index_small', :locals => {:tool => tool} %>
					<% end %>

					<div>
						<div class='btn-group pull-right btn-group-hanging'>
							<a href='/tools/new' class='btn btn-mini'>
								<i class='icon-plus'></i>&nbsp;New
							</a>
							<% if my_tools.size > 5 %>
								<a href='tools?query=&roles=owner&order=created_at' class='btn btn-mini'>
									<i class='icon-list'>&nbsp;List All</i>
								</a>
							<% end %>
						</div>
					</div>
					<br/>
				</div> <!-- end of box content -->
			</div> <!-- end of box -->
		<% end %>

		

	</div>

</div>
<script type='text/javascript' src='<%= @faye_url %>.js'></script>
<%= javascript_include_tag "handle_box_toggleable.js" %>
<%= javascript_include_tag "user_home.js" %>